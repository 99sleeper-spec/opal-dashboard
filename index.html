<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Model Y Performance ‚Äî Ownership Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --border: #1e1e2e;
            --text-primary: #e8e8ed;
            --text-secondary: #8888a0;
            --text-dim: #55556a;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-amber: #f59e0b;
            --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4;
            --tesla-red: #e82127;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        .bg-grid {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-image:
                linear-gradient(rgba(59,130,246,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59,130,246,0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            z-index: 0;
        }
        .bg-glow {
            position: fixed; width: 600px; height: 600px; border-radius: 50%;
            filter: blur(120px); opacity: 0.07; z-index: 0;
            animation: drift 20s ease-in-out infinite;
        }
        .bg-glow-1 { top: -200px; left: -200px; background: var(--accent-blue); }
        .bg-glow-2 { bottom: -200px; right: -200px; background: var(--accent-green); animation-delay: -10s; }
        @keyframes drift { 0%,100%{transform:translate(0,0)} 50%{transform:translate(40px,30px)} }

        .container { position: relative; z-index: 1; max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem 4rem; }

        .header { text-align: center; margin-bottom: 3rem; padding-top: 1rem; }
        .badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.2); border-radius: 100px; padding: 0.4rem 1rem; font-size: 0.8rem; font-weight: 500; color: var(--accent-blue); letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 1.2rem; }
        .badge .dot { width: 6px; height: 6px; background: var(--accent-green); border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
        .header h1 { font-size: 2.8rem; font-weight: 800; letter-spacing: -0.03em; background: linear-gradient(135deg, #e8e8ed, #8888a0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header h1 em { font-style: normal; background: linear-gradient(135deg, var(--tesla-red), var(--accent-amber)); -webkit-background-clip: text; }
        .header-sub { color: var(--text-secondary); font-size: 1rem; margin-top: 0.8rem; font-weight: 300; }
        .header-sub strong { color: var(--text-primary); font-weight: 500; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; position: relative; overflow: hidden; transition: all 0.3s ease; }
        .stat-card:hover { background: var(--bg-card-hover); border-color: rgba(59,130,246,0.3); transform: translateY(-2px); }
        .stat-card .lbl { font-size: 0.72rem; font-weight: 500; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem; }
        .stat-card .val { font-size: 2rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; letter-spacing: -0.02em; }
        .stat-card .sub { font-size: 0.78rem; color: var(--text-dim); margin-top: 0.3rem; }
        .stat-card .ico { position: absolute; top: 1.2rem; right: 1.2rem; font-size: 1.3rem; opacity: 0.5; }
        .green .val{color:var(--accent-green)} .blue .val{color:var(--accent-blue)} .amber .val{color:var(--accent-amber)} .red .val{color:var(--accent-red)} .purple .val{color:var(--accent-purple)} .cyan .val{color:var(--accent-cyan)}

        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem; }
        .card h2 { font-size: 1.15rem; font-weight: 600; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.6rem; }

        .chart-box { position: relative; height: 280px; width: 100%; }
        .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem; }

        .ai-card { background: linear-gradient(135deg, rgba(139,92,246,0.08), rgba(59,130,246,0.08)); border: 1px solid rgba(139,92,246,0.2); border-radius: 20px; padding: 2rem; margin-bottom: 2rem; position: relative; }
        .ai-card::before { content:''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue), var(--accent-cyan)); border-radius: 20px 20px 0 0; }
        .ai-card h2 { font-size: 0.9rem; font-weight: 600; color: var(--accent-purple); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem; }
        .ai-card .insight { font-size: 1rem; line-height: 1.7; font-weight: 300; }

        .prog-labels { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.4rem; }
        .prog-track { height: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; }
        .prog-fill { height: 100%; border-radius: 10px; background: linear-gradient(90deg, var(--accent-blue), var(--accent-green)); transition: width 1s ease; }

        .tires { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 260px; margin: 1rem auto; }
        .tire { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; padding: 1rem; text-align: center; }
        .tire .pos { font-size: 0.68rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.3rem; }
        .tire .psi { font-family: 'JetBrains Mono'; font-size: 1.3rem; font-weight: 600; }
        .tire.ok .psi{color:var(--accent-green)} .tire.warn .psi{color:var(--accent-amber)} .tire.low .psi{color:var(--accent-red)}

        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { text-align: left; padding: 0.7rem 0.8rem; font-weight: 500; color: var(--text-secondary); border-bottom: 1px solid var(--border); font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.05em; }
        td { padding: 0.7rem 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.03); }
        tr:hover td { background: rgba(255,255,255,0.02); }
        .mono { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; }

        .footer { text-align: center; color: var(--text-dim); font-size: 0.75rem; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border); }

        .fade-in { opacity: 0; transform: translateY(20px); animation: fadeIn 0.6s ease forwards; }
        @keyframes fadeIn { to{opacity:1;transform:translateY(0)} }
        .d1{animation-delay:.1s} .d2{animation-delay:.2s} .d3{animation-delay:.3s} .d4{animation-delay:.4s} .d5{animation-delay:.5s}

        @media(max-width:768px) {
            .row2{grid-template-columns:1fr}
            .header h1{font-size:2rem}
            .stats-grid{grid-template-columns:repeat(2,1fr)}
        }
    </style>
</head>
<body>
<div class="bg-grid"></div>
<div class="bg-glow bg-glow-1"></div>
<div class="bg-glow bg-glow-2"></div>

<div class="container">
    <header class="header fade-in">
        <div class="badge"><span class="dot"></span> Live Ownership Data</div>
        <h1>2024 Model Y <em>Performance</em></h1>
        <p class="header-sub">Real ownership economics ‚Äî no cherry-picking, no BS.<br>Replaced a <strong>2016 Mazda CX-5</strong> on August 3, 2024.</p>
    </header>

    <div class="stats-grid fade-in d1">
        <div class="stat-card green"><div class="lbl">Gas Equivalent MPG</div><div class="val" id="s-mpg">--</div><div class="sub">30-day avg</div><div class="ico">‚õΩ</div></div>
        <div class="stat-card blue"><div class="lbl">Miles Tracked</div><div class="val" id="s-miles">--</div><div class="sub">Since Aug 2024</div><div class="ico">üõû</div></div>
        <div class="stat-card amber"><div class="lbl">Net Savings vs CX-5</div><div class="val" id="s-net">--</div><div class="sub">Fuel + maint ‚àí insurance</div><div class="ico">üí∞</div></div>
        <div class="stat-card cyan"><div class="lbl">Electricity Cost</div><div class="val" id="s-elec">--</div><div class="sub">@ $0.11543/kWh</div><div class="ico">‚ö°</div></div>
        <div class="stat-card purple"><div class="lbl">Est. Resale Value</div><div class="val" id="s-resale">--</div><div class="sub">Private party</div><div class="ico">üè∑Ô∏è</div></div>
        <div class="stat-card red"><div class="lbl">Break-Even</div><div class="val" id="s-be">--%</div><div class="sub">of $38,030 premium</div><div class="ico">üéØ</div></div>
    </div>

    <div class="ai-card fade-in d2">
        <h2>‚ú® AI Analysis</h2>
        <div class="insight" id="ai-text">Connect your Raspberry Pi to start seeing AI-generated insights about your ownership data here.</div>
    </div>

    <div class="card fade-in d3">
        <h2>üéØ Break-Even Tracker</h2>
        <p style="color:var(--text-secondary);font-size:0.88rem;margin-bottom:1.2rem">Tracking how long until savings cover the $38,030 Tesla premium ‚Äî <em>honestly including</em> the ~$119/mo insurance increase.</p>
        <div class="stats-grid" style="margin-bottom:1rem">
            <div style="text-align:center"><div style="font-size:.68rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:.1em">Fuel Savings</div><div style="font-family:'JetBrains Mono';font-size:1.3rem;color:var(--accent-green)" id="be-fuel">$0</div></div>
            <div style="text-align:center"><div style="font-size:.68rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:.1em">Maint. Saved</div><div style="font-family:'JetBrains Mono';font-size:1.3rem;color:var(--accent-green)" id="be-maint">$0</div></div>
            <div style="text-align:center"><div style="font-size:.68rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:.1em">Insurance ‚Üë</div><div style="font-family:'JetBrains Mono';font-size:1.3rem;color:var(--accent-red)" id="be-ins">‚àí$0</div></div>
            <div style="text-align:center"><div style="font-size:.68rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:.1em">Net Savings</div><div style="font-family:'JetBrains Mono';font-size:1.3rem" id="be-net">$0</div></div>
        </div>
        <div class="prog-labels"><span>$0</span><span>$38,030</span></div>
        <div class="prog-track"><div class="prog-fill" id="be-bar" style="width:0%"></div></div>
        <p style="color:var(--text-dim);font-size:.8rem;margin-top:.6rem;text-align:center" id="be-eta">Calculating...</p>
    </div>

    <div class="row2 fade-in d4">
        <div class="card"><h2>‚õΩ Gas Equivalent MPG</h2><div class="chart-box"><canvas id="c-mpg"></canvas></div></div>
        <div class="card"><h2>üí∞ Cumulative Savings</h2><div class="chart-box"><canvas id="c-save"></canvas></div></div>
    </div>
    <div class="row2 fade-in d5">
        <div class="card"><h2>üíµ Cost per Charge</h2><div class="chart-box"><canvas id="c-cost"></canvas></div></div>
        <div class="card"><h2>üå°Ô∏è Efficiency vs Temp</h2><div class="chart-box"><canvas id="c-temp"></canvas></div></div>
    </div>

    <div class="row2 fade-in">
        <div class="card">
            <h2>üõû Tire Pressures</h2>
            <p style="color:var(--text-secondary);font-size:.82rem;text-align:center;margin-bottom:.5rem">Recommended: 42 PSI</p>
            <div class="tires">
                <div class="tire ok" id="t-fl"><div class="pos">Front Left</div><div class="psi">--</div></div>
                <div class="tire ok" id="t-fr"><div class="pos">Front Right</div><div class="psi">--</div></div>
                <div class="tire ok" id="t-rl"><div class="pos">Rear Left</div><div class="psi">--</div></div>
                <div class="tire ok" id="t-rr"><div class="pos">Rear Right</div><div class="psi">--</div></div>
            </div>
        </div>
        <div class="card"><h2>üîã Battery Health</h2><div class="chart-box" style="height:200px"><canvas id="c-bat"></canvas></div><p style="color:var(--text-dim);font-size:.78rem;text-align:center;margin-top:.5rem">Estimated max range (303 mi new)</p></div>
    </div>

    <div class="card fade-in">
        <h2>üìã Recent Charges</h2>
        <div style="overflow-x:auto">
            <table>
                <thead><tr><th>Date</th><th>Type</th><th>kWh</th><th>Cost</th><th>Miles</th><th>Gas Equiv MPG</th><th>CX-5 Cost</th><th>Saved</th></tr></thead>
                <tbody id="tbl"></tbody>
            </table>
        </div>
    </div>

    <footer class="footer">
        <p>Powered by Raspberry Pi 5 + TeslaPy + Pushover + Google Sheets + AI</p>
        <p style="margin-top:.3rem">Last updated: <span id="updated">--</span></p>
    </footer>
</div>

<script>
Chart.defaults.color='#8888a0';
Chart.defaults.borderColor='rgba(255,255,255,0.04)';
const CHART_OPTS={responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{grid:{display:false},ticks:{maxTicksLimit:10,font:{size:11}}},y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{font:{size:11}}}}};

async function loadData(){
    try{
        const r=await fetch('data/dashboard_data.json');
        if(!r.ok) return useSampleData();
        return await r.json();
    }catch(e){return useSampleData();}
}

function useSampleData(){
    // Sample data for preview before Pi is connected
    const charges=[];
    const startDate=new Date('2024-08-10');
    let cumSav=0, odo=1200;
    for(let i=0;i<30;i++){
        const d=new Date(startDate);d.setDate(d.getDate()+i*3);
        const miles=40+Math.random()*60;
        const kwh=miles/3.5+Math.random()*3;
        const cost=kwh*0.11543;
        const gasP=2.70+Math.random()*0.5;
        const eqGal=cost/gasP;
        const gasMpg=miles/eqGal;
        const cx5Cost=(miles/28)*gasP;
        const sav=cx5Cost-cost;
        cumSav+=sav;
        odo+=miles;
        charges.push({date:d.toISOString().split('T')[0],miles:+miles.toFixed(1),kwh:+kwh.toFixed(1),cost:+cost.toFixed(2),gas_mpg:+gasMpg.toFixed(0),gas_price:+gasP.toFixed(2),savings:+sav.toFixed(2),soc_before:Math.floor(30+Math.random()*30),soc_after:80,temp:Math.floor(35+Math.random()*50),charge_type:Math.random()>0.9?'supercharger':'home'});
    }
    return{
        updated_at:new Date().toISOString(),
        summary:{total_charges:charges.length,total_miles:+charges.reduce((a,c)=>a+c.miles,0).toFixed(0),total_kwh:+charges.reduce((a,c)=>a+c.kwh,0).toFixed(0),total_electricity_cost:+charges.reduce((a,c)=>a+c.cost,0).toFixed(2),total_fuel_savings:+cumSav.toFixed(2),avg_gas_equiv_mpg:87,breakeven:{fuel_savings:cumSav,maintenance_savings:520,insurance_cost:2150,net_savings:cumSav+520-2150,breakeven_pct:+((cumSav+520-2150)/38030*100).toFixed(1),months_remaining:72,tesla_premium:38030},resale_value:42500},
        ai_insight:"This Model Y Performance has averaged 87 Gas Equivalent MPG over 30 tracked charges, meaning every dollar spent on electricity goes roughly 3x farther than it would at the pump. After factoring in the $119/month insurance increase, net savings are modest at around $52/month ‚Äî but the CX-5 was approaching the age where major repairs become likely, which isn't captured in the numbers yet. Efficiency has been notably lower during the recent cold snap, dropping about 15% when temps fell below 40¬∞F. At the current pace, break-even on the Tesla premium is projected around year 6 of ownership.",
        charge_history:charges
    };
}

function $(id){return document.getElementById(id);}
function fmt$(n){return n<0?'-$'+Math.abs(n).toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0}):'$'+n.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0});}

async function init(){
    const data=await loadData();
    const s=data.summary, h=data.charge_history, be=s.breakeven;

    // Stats
    $('s-mpg').textContent=s.avg_gas_equiv_mpg||'--';
    $('s-miles').textContent=(+s.total_miles).toLocaleString();
    $('s-net').textContent=fmt$(Math.round(be.net_savings));
    $('s-elec').textContent='$'+(+s.total_electricity_cost).toFixed(0);
    $('s-resale').textContent='$'+(+s.resale_value).toLocaleString();
    $('s-be').textContent=be.breakeven_pct+'%';

    // AI
    $('ai-text').textContent=data.ai_insight||'Awaiting data...';

    // Break-even
    $('be-fuel').textContent=fmt$(Math.round(be.fuel_savings));
    $('be-maint').textContent=fmt$(Math.round(be.maintenance_savings));
    $('be-ins').textContent='‚àí$'+Math.abs(Math.round(be.insurance_cost)).toLocaleString();
    const net=be.net_savings;
    $('be-net').textContent=fmt$(Math.round(net));
    $('be-net').style.color=net>=0?'var(--accent-green)':'var(--accent-red)';
    $('be-bar').style.width=Math.max(0,Math.min(100,be.breakeven_pct))+'%';
    $('be-eta').textContent=be.months_remaining?`Estimated break-even in ~${Math.round(be.months_remaining/12*10)/10} years`:'Calculating...';

    // Charts
    const dates=h.map(c=>c.date.slice(5));
    const mpgs=h.map(c=>c.gas_mpg);
    const savs=h.map(c=>{let t=0;return h.slice(0,h.indexOf(c)+1).reduce((a,x)=>a+x.savings,0);});
    const costs=h.map(c=>c.cost);
    const temps=h.filter(c=>c.temp).map(c=>({x:+c.temp,y:+c.gas_mpg}));

    new Chart($('c-mpg'),{type:'line',data:{labels:dates,datasets:[{data:mpgs,borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.1)',fill:true,tension:.3,pointRadius:3,pointBackgroundColor:'#10b981'}]},options:{...CHART_OPTS,scales:{...CHART_OPTS.scales,y:{...CHART_OPTS.scales.y,title:{display:true,text:'MPG Equivalent',color:'#55556a',font:{size:11}}}}}});

    new Chart($('c-save'),{type:'line',data:{labels:dates,datasets:[{data:savs,borderColor:'#f59e0b',backgroundColor:'rgba(245,158,11,0.1)',fill:true,tension:.3,pointRadius:2}]},options:{...CHART_OPTS,scales:{...CHART_OPTS.scales,y:{...CHART_OPTS.scales.y,ticks:{callback:v=>'$'+v}}}}});

    const homeC=h.filter(c=>c.charge_type==='home').map(c=>c.cost);
    const scC=h.filter(c=>c.charge_type==='supercharger').map(c=>c.cost);
    new Chart($('c-cost'),{type:'bar',data:{labels:dates,datasets:[{label:'Home',data:h.map(c=>c.charge_type==='home'?c.cost:0),backgroundColor:'rgba(59,130,246,0.7)',borderRadius:4},{label:'Supercharger',data:h.map(c=>c.charge_type==='supercharger'?c.cost:0),backgroundColor:'rgba(239,68,68,0.7)',borderRadius:4}]},options:{...CHART_OPTS,plugins:{legend:{display:true,labels:{color:'#8888a0',boxWidth:12,font:{size:11}}}},scales:{...CHART_OPTS.scales,x:{...CHART_OPTS.scales.x,stacked:true},y:{...CHART_OPTS.scales.y,stacked:true,ticks:{callback:v=>'$'+v}}}}});

    if(temps.length>3){
        new Chart($('c-temp'),{type:'scatter',data:{datasets:[{data:temps,backgroundColor:'rgba(6,182,212,0.6)',pointRadius:5}]},options:{...CHART_OPTS,scales:{x:{title:{display:true,text:'¬∞F',color:'#55556a'},grid:{color:'rgba(255,255,255,0.04)'}},y:{title:{display:true,text:'Gas Equiv MPG',color:'#55556a'},grid:{color:'rgba(255,255,255,0.04)'}}}}});
    }

    // Tire pressures (from latest charge)
    if(h.length){
        const last=h[h.length-1];
        ['fl','fr','rl','rr'].forEach(p=>{
            // Sample pressures for preview
            const psi=40+Math.random()*4;
            const el=$('t-'+p);
            el.querySelector('.psi').textContent=psi.toFixed(1)+' PSI';
            el.className='tire '+(psi<39?'low':psi<40?'warn':'ok');
        });
    }

    // Battery chart (sample)
    new Chart($('c-bat'),{type:'line',data:{labels:dates.filter((_,i)=>i%3===0),datasets:[{data:dates.filter((_,i)=>i%3===0).map((_,i)=>303-i*0.3-Math.random()*0.5),borderColor:'#8b5cf6',backgroundColor:'rgba(139,92,246,0.1)',fill:true,tension:.4,pointRadius:2}]},options:{...CHART_OPTS,scales:{...CHART_OPTS.scales,y:{...CHART_OPTS.scales.y,min:270,max:310,title:{display:true,text:'Max Range (mi)',color:'#55556a',font:{size:11}}}}}});

    // Table
    const tbody=$('tbl');
    tbody.innerHTML='';
    h.slice(-15).reverse().forEach(c=>{
        const tr=document.createElement('tr');
        const typeColor=c.charge_type==='supercharger'?'var(--accent-red)':'var(--accent-blue)';
        tr.innerHTML=`
            <td class="mono">${c.date}</td>
            <td style="color:${typeColor}">${c.charge_type==='supercharger'?'‚ö° SC':'üè† Home'}</td>
            <td class="mono">${c.kwh}</td>
            <td class="mono">$${c.cost.toFixed(2)}</td>
            <td class="mono">${c.miles.toFixed(0)}</td>
            <td class="mono" style="color:var(--accent-green)">${c.gas_mpg}</td>
            <td class="mono">$${(c.miles/28*c.gas_price).toFixed(2)}</td>
            <td class="mono" style="color:var(--accent-green)">+$${c.savings.toFixed(2)}</td>`;
        tbody.appendChild(tr);
    });

    $('updated').textContent=new Date(data.updated_at).toLocaleString();
}

init();
</script>
</body>
</html>
